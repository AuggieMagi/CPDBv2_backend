machine:
  python:
    version: 2.7.11
  environment:
    DJANGO_SETTINGS_MODULE: config.settings.test

database:
  post:
    - psql -c "CREATE EXTENSION postgis;" -d circle_test

dependencies:
  override:
    - pip install -r requirements/test.txt
    - pip install ansible
    - sudo ansible-galaxy install azavea.postgresql

test:
  override:
    - flake8
    - coverage run cpdb/manage.py test --noinput --nologcapture
  post:
    - coverage combine
    - coverage report --omit="/home/ubuntu/virtualenvs/*,common/json_serializer.py"
    - coveralls

deployment:
  staging:
    branch: staging
    commands:
      - bin/circle_deploy_staging
