#!/usr/bin/env bash

GIT_COMMIT_MSG=`git log --format=%B -n 1 $CIRCLE_SHA1`

if [[ $GIT_COMMIT_MSG == *"[skip rebuild_index]"* ]]; then
  REBUILD_INDEX="false"
else
  REBUILD_INDEX="true"
fi

echo $ANSIBLE_VAULT_PASSWORD > vault_pass.txt

ansible-playbook ansible/staging.yml \
  -i ansible/inventory/staging \
  --tags "deploy" \
  --vault-password-file ./vault_pass.txt \
  --extra-vars "{\"run_rebuild_index\": $REBUILD_INDEX}"
