# -*- coding: utf-8 -*-
from django.db import migrations
from tqdm import tqdm

rank_correcting_mapping = ranks = {
    'accounting tech 2': 'Accounting Technician II',
    'admin assist 2': 'Administrative Assistant II',
    'admin assist 3': 'Administrative Assistant III',
    'admin serv off i -excluded': 'Administrative Services Officer I - Excluded',
    'admin serv off ii': 'Administrative Services Officer II',
    'admin serv officer i': 'Administrative Services Officer I',
    'admin. manager': 'Administration Manager',
    'area coordinator': 'Area Coordinator',
    'assist director': 'Assistant Director',
    'associate staff attorney': 'Associate Staff Attorney',
    'asst deputy sup': 'Assistant Deputy Superintendent',
    'asst dir finance': 'Assistant Director Finance',
    'asst dir news affair': 'Assistant Director News Affair',
    'asst gen counsel': 'Assistant General Counsel',
    'asst supv police rec': 'Assistant Supervisor Police Records',
    'asst to director': 'Assistant to Director',
    'attorney': 'Attorney',
    'auditor iii': 'Auditor II',
    'caps coordinator': 'CAPS Coordinator',
    'captain of police': 'Captain of Police',
    'ch voucher expediter': 'Chief Voucher Expediter',
    'chief': 'Chief',
    'chief oper research': 'Chief Operations Research',
    'chief prog/analyst': 'Chief Programmer / Analyst',
    'chief sys prog i': 'Chief System Programmer I',
    'chief sys prog is': 'Chief System Programmer I',
    'chief syst prog': 'Chief System Programmer',
    'clerk 3': 'Clerk III',
    'clerk 4': 'Clerk IV',
    'clinical therapist 3': 'Clinical Therapist III',
    'cmdr': 'Commander',
    'cmdr taffic enforce': 'Commander Traffic Enforcement',
    'comm neighborhood re': 'Comm Neighborhood Re',
    'comm of genl support': 'Comm Of Genl Support',
    'commander': 'Commander',
    'commander spec serv': 'Commander Spec Serv',
    'community organizer': 'Community Organizer',
    'comp tool mark exam': 'Comp Tool Mark Exam',
    'cont rev spec ii': 'Contract Review Specialist II',
    'contract coordinator': 'Contract Coordinator',
    'coor /investigations': 'Coordinator / Investigations',
    'coor spec events': 'Coordinator Special Events',
    'coord special projec': 'Coordinator Special Projects',
    'crim hist anal': 'Criminal History Analysis',
    'criminalist 3': 'Criminalist III',
    'crossing guard': 'Crossing Guard',
    'crossing guard coor': 'Crossing Guard Coordinator',
    'data entry operator': 'Data Entry Operator',
    'dep chief': 'Deputy Chief',
    'deputy director': 'Deputy Director',
    'deputy supt.': 'Deputy Superintendent',
    'det': 'Detective',
    'detention aide': 'Detention Aide',
    'dir grants mgmt': 'Director Grants Management',
    'dir labor relations': 'Director Labor Relations',
    'dir mgt/lab affairs': 'Director Management / Labor Affairs',
    'dir of motor maint': 'Director of Motor Maintenance',
    'dir personnel serv': 'Director Personnel Services',
    'dir police finance': 'Director Police Finance',
    'dir research/planing': 'Director Research / Planning',
    'dir. of new affairs': 'Director of News Affairs',
    'director of admin 2': 'Director Administration II',
    'director of caps': 'Director of CAPS',
    'director of facilities': 'Director of Facilities',
    'dist watch co': 'District Watch Commander',
    'emp comp tech 3': 'Emp Computer Technician III',
    'ex dir of police brd': 'Ex Director of Police Board',
    'expl tech 1': 'Explosives Tech I',
    'expl tech 3': 'Explosives Tech III',
    'explosives tech 2': 'Explosives Tech III',
    'f/a id tech 1': 'Forensic ID Tech I',
    'f/a id tech 2': 'Forensic ID Tech II',
    'f/p tech 2': 'Fingerprint Tech II',
    'f/p tech 3': 'Fingerprint Tech III',
    'fingerprint tech 1': 'Fingerprint Tech I',
    'fingerprt techiv': 'Fingerprint Tech IV',
    'first deputy supt.': 'First Deputy Superintendent',
    'fiscal administrator': 'Fiscal Administrator',
    'forensic firearm/evidence ident tech': 'Forensic Firearm / Evidence Identification Technician',
    'freedom of information act officer': 'Freedom of Information Act Officer',
    'general counsel to the superintendent': 'General Counsel to the Superintendent',
    'grants research spec': 'Grants Research Specialist',
    'graphic artist iii': 'Graphic Artist III',
    'information ser coor': 'Information Services Coordinator',
    'investigator': 'Investigator',
    'lab tech iii': 'Lab Tech III',
    'lieutenant of police': 'Lieutenant of Police',
    'lt': 'Lieutenant of Police',
    'manager of police records': 'Manager of Police Records',
    'manager pol payroll': 'Manager Police Payroll',
    'medical services coordinator-cpd': 'Medical Services Coordinator',
    'mgr data entry opers': 'Manager Data Entry Operations',
    'mgr police personnel': 'Manager Police Personnel',
    'p o assgn sec spec': 'Police Officer Assigned Security Specialist',
    'p.o. assigned as helicopter pilot': 'Police Officer Assigned as Helicopter Pilot',
    'paralegal ii': 'Paralegal II',
    'per comp oper 3': 'Personal Comp Oper III',
    'pers assist ii': 'Personal Assistant II',
    'personal comp oper 1': 'Personal Comp Oper I',
    'personal comp oper 2': 'Personal Comp Oper II',
    'physical fitnes coor': 'Physical Fitness Coordinator',
    'po': 'Police Officer',
    'po (per arb award)': 'Police Officer (Per Arbitration Award)',
    'po as detective': 'Police Officer as Detective',
    'po as supv pol inv': 'Police Officer as Supv Pol Inv',
    'po asgn evid. techni': 'Police Officer Assigned Evidence Technician',
    'po asgn laten f/p ex': 'Police Officer Assigned Latent Fingerprint Examiner',
    'po asgn supv lat fp': 'Police Officer Assigned Supervisor Latent Fingerprint Examiner',
    'po assg canine handl': 'Police Officer Assigned Canine Handler',
    'po assgn traff spec': 'Police Officer Assigned Traffic Specialist',
    'po assgn traff spec': 'Police Officer Assigned Traffic Specialist',
    'po assign as armorer': 'Police Officer Assigned as Armorer',
    'po legal off 1': 'Police Officer Legal Office I',
    'po legal off 2': 'Police Officer Legal Office II',
    'po sub abuse counslr': 'Police Officer Substance Abuse Counselor',
    'po/exp det can hand': 'Police Officer / Explosives Detective Canine Handler',
    'po/field trning off': 'Police Officer / Field Training Officer',
    'po/marine officer': 'Police Officer / Marine Officer',
    'po/marine officer': 'Police Officer / Marine Officer',
    'po/mounted pat off.': 'Police Officer / Mounted Patrol Officer',
    'po/mounted pat off.': 'Police Officer / Mounted Patrol Officer',
    'pol forensic inv i': 'Police Forensic Investigator I',
    'pol forensic inv i': 'Police Forensic Investigator I',
    'pol forensic inv ii': 'Police Forensic Investigator II',
    'pol forensic inv iii': 'Police Forensic Investigator III',
    'pol lab tech 2': 'Police Lab Technician II',
    'pol lab tech 4': 'Police Lab Technician IV',
    'police administrative clerk': 'Police Administrative Clerk',
    'police cadet': 'Police Cadet',
    'police officer': 'Police Officer',
    'pr database analyst': 'PR Database Analyst',
    'pr prog/analyst': 'PR Programmer / Analyst',
    'prin systems prog': 'Principal Systems Programmer',
    'prog anly': 'Program Analysis',
    'prog devel coord': 'Program Development Coordinator',
    'prog/analyst': 'Programmer / Analyst',
    'projects admin.': 'Projects Administrator',
    'property custodian': 'Property Custodian',
    'public inform off': 'Public Information Officer',
    'sergeant of police': 'Sergeant of Police',
    'sergeant per arbitra': 'Sergeant Per Arbitration',
    'sgt': 'Sergeant',
    'sgt assgn sec spec': 'Sergeant Assigned Security Specialist',
    'sr data entry opr': 'SR Data Entry Operations',
    'sr database analyst': 'SR Database Analyst',
    'sr evid tech': 'SR Evidence Technician',
    'sr photo technician': 'SR Photo Technician',
    'sr prog/analy': 'SR Programmer / Analyst',
    'sr. res analyst': 'SR Research Analyst',
    'staff assistant': 'Staff Assistant',
    'subpoena officer': 'Subpoena Officer',
    'suprv clerk': 'Supervisor Clerk',
    'supt of police': 'Superintendent of Police',
    'supt of police': 'Superintendent of Police',
    "supt's chief of staff": "Superintendent's Chief of Staff",
    'supts chief of staff': "Superintendent's Chief of Staff",
    'supv data entry oper': 'Supervisor Data Entry Operations',
    'supv inven cont 1': 'Supervisor Inventory Control I',
    'supv pol soc referal': 'Supervisor of Police Social Referral',
    'supv.property cust.': 'Supervisor Property Custody',
    'tech training asst': 'Tech Training Assistant',
    'timekeeper cpd': 'Timekeeper CPD',
    'training director': 'Training Director',
    'training officer': 'Training Officer',
    'unknown': 'Unknown',
    'warrant & extr aide': 'Warrant & Extradition Aide',
    'youth serv coor': 'Youth Services Coordinator'
}


def normalize_officer_rank(apps, schema_editor):
    Officer = apps.get_model('data', 'Officer')
    unique_ranks = list(set(map(str.lower, Officer.objects.values_list('rank', flat=True).distinct())))
    updating_ranks = [rank for rank in unique_ranks if rank in rank_correcting_mapping]

    for rank in tqdm(updating_ranks, desc=f'Updating officer ranks'):
        Officer.objects.filter(rank__iexact=rank).update(rank=rank_correcting_mapping[rank])


class Migration(migrations.Migration):
    dependencies = [
        ('data', '0091_correct_allegations_subjects_default'),
    ]

    operations = [
        migrations.RunPython(
            normalize_officer_rank,
            reverse_code=migrations.RunPython.noop,
            elidable=True),
    ]
